// CBD - LAB4 - EX4 - 98388
// Dataset: https://www.kaggle.com/deepshah16/formula-1-19502020

Query n1: Get all drivers that raced in 30-Aug-20 and order them by the position. Show the name of the Gran Prix too.
MATCH (driver:Driver)-[r:RACED_IN]->(race:Race {date: '30-Aug-20'}) RETURN race.name, r.position, driver.name ORDER BY r.position ASC

   | race.name                                       | r.position                                      | driver.name                                     
   | Belgium.64                                      | 1                                               | Lewis Hamilton HAM                              
   | Belgium.64                                      | 2                                               | Valtteri Bottas BOT                             
   | Belgium.64                                      | 3                                               | Max Verstappen VER                              
   | Belgium.64                                      | 4                                               | Daniel Ricciardo RIC                            
   | Belgium.64                                      | 5                                               | Esteban Ocon OCO                                
   | Belgium.64                                      | 6                                               | Alexander Albon ALB                             
   | Belgium.64                                      | 7                                               | Lando Norris NOR                                
   | Belgium.64                                      | 8                                               | Pierre Gasly GAS                                
   | Belgium.64                                      | 9                                               | Lance Stroll STR                                
   | Belgium.64                                      | 10                                              | Sergio Perez PER                                
   | Belgium.64                                      | 11                                              | Daniil Kvyat KVY                                
   | Belgium.64                                      | 13                                              | Sebastian Vettel VET                            
   | Belgium.64                                      | 14                                              | Charles Leclerc LEC                             
   | Belgium.64                                      | 15                                              | Romain Grosjean GRO                             
   | Belgium.64                                      | 16                                              | Nicholas Latifi LAT                             
   | Belgium.64                                      | 17                                              | Kevin Magnussen MAG                             
   | Belgium.64                                      | 18                                              | Antonio Giovinazzi GIO                          
   | Belgium.64                                      | 19                                              | George Russell RUS                              
   | Belgium.64                                      | 20                                              | Carlos Sainz SAI                                



Query n2: Count the number of races each driver has participated, the number of races he won and his win-ratio (%). Present only 20 of them by number of wins in descending order.
MATCH (driver:Driver)-[r:RACED_IN]->(n:Race) WHERE r.position = 1 WITH driver, count(driver) AS num_wins ORDER BY num_wins DESC MATCH (driver)-[r]->(race:Race) WITH driver,num_wins,count(race) AS num_races, round(num_wins * 100 / count(race),2) AS win_ratio RETURN driver.name, driver.nationality,num_races,num_wins,win_ratio LIMIT 20

   | driver.name                                     | driver.nationality                              | num_races                                       | num_wins                                        | win_ratio                                       
   | Michael Schumacher MSC                          | GER                                             | 297                                             | 90                                              | 30.0                                            
   | Lewis Hamilton HAM                              | GBR                                             | 254                                             | 89                                              | 35.0                                            
   | Sebastian Vettel VET                            | GER                                             | 244                                             | 53                                              | 21.0                                            
   | Alain Prost PRO                                 | FRA                                             | 193                                             | 51                                              | 26.0                                            
   | Ayrton Senna SEN                                | BRA                                             | 153                                             | 41                                              | 26.0                                            
   | Fernando Alonso ALO                             | ESP                                             | 310                                             | 32                                              | 10.0                                            
   | Nigel Mansell MAN                               | GBR                                             | 181                                             | 31                                              | 17.0                                            
   | Jackie Stewart STE                              | GBR                                             | 98                                              | 27                                              | 27.0                                            
   | Niki Lauda LAU                                  | AUT                                             | 168                                             | 25                                              | 14.0                                            
   | Jim Clark CLA                                   | GBR                                             | 73                                              | 25                                              | 34.0                                            
   | Juan Manuel Fangio FAN                          | ARG                                             | 56                                              | 23                                              | 41.0                                            
   | Nelson Piquet PIQ                               | BRA                                             | 225                                             | 23                                              | 10.0                                            
   | Nico Rosberg ROS                                | GER                                             | 202                                             | 23                                              | 11.0                                            
   | Damon Hill HIL                                  | GBR                                             | 114                                             | 22                                              | 19.0                                            
   | Mika Hakkinen HAK                               | FIN                                             | 158                                             | 20                                              | 12.0                                            
   | Jenson Button BUT                               | GBR                                             | 302                                             | 15                                              | 4.0                                             
   | Stirling Moss MOS                               | GBR                                             | 69                                              | 15                                              | 21.0                                            
   | Jack Brabham BRA                                | AUS                                             | 126                                             | 15                                              | 11.0                                            
   | Graham Hill HIL                                 | GBR                                             | 173                                             | 14                                              | 8.0                                             
   | Emerson Fittipaldi FIT                          | BRA                                             | 142                                             | 14                                              | 9.0                                             



Query n3: List all the drivers that raced for 'Ferrari' before 1990 (old scoring system), their nationality, the number of years they spent in the team, the list of years they spent in the team and all the points they earned for the team. Order them by points scored in descending order.
MATCH (driver:Driver)-[r:DRIVED_FOR]->(team:Team {name: 'Ferrari'}) WITH driver, team, sum(toInteger(r.points)) AS points, count(r.year) AS years_spent, collect(r.year) AS list_years WHERE all(year in list_years WHERE toInteger(year) <= 1990) RETURN driver.name, driver.nationality, team.name, years_spent, list_years, points ORDER BY points DESC

   | driver.name                                     | driver.nationality                              | team.name                                       | years_spent                                     | list_years                                      | points                                          
   | Niki Lauda LAU                                  | AUT                                             | Ferrari                                         | 4                                               | ['1976', '1974', '1975', '1977']                | 242                                             
   | Clay Regazzoni REG                              | SUI                                             | Ferrari                                         | 6                                               | ['1970', '1972', '1976', '1971', '1974', '1975']| 169                                             
   | Michele Alboreto ALB                            | ITA                                             | Ferrari                                         | 5                                               | ['1985', '1987', '1986', '1988', '1984']        | 138                                             
   | Jacky Ickx ICK                                  | BEL                                             | Ferrari                                         | 4                                               | ['1968', '1972', '1970', '1971']                | 113                                             
   | Alberto Ascari ASC                              | ITA                                             | Ferrari                                         | 4                                               | ['1950', '1952', '1953', '1951']                | 106                                             
   | Gilles Villeneuve VIL                           | CAN                                             | Ferrari                                         | 5                                               | ['1981', '1978', '1982', '1979', '1980']        | 101                                             
   | Mike Hawthorn HAW                               | GBR                                             | Ferrari                                         | 4                                               | ['1954', '1953', '1957', '1958']                | 98                                              
   | Carlos Reutemann REU                            | ARG                                             | Ferrari                                         | 3                                               | ['1978', '1976', '1977']                        | 93                                              
   | Rene Arnoux ARN                                 | FRA                                             | Ferrari                                         | 3                                               | ['1985', '1984', '1983']                        | 79                                              
   | John Surtees SUR                                | GBR                                             | Ferrari                                         | 3                                               | ['1964', '1963', '1965']                        | 79                                              
   | Phil Hill HIL                                   | USA                                             | Ferrari                                         | 4                                               | ['1962', '1961', '1959', '1958']                | 77                                              
   | Nigel Mansell MAN                               | GBR                                             | Ferrari                                         | 2                                               | ['1990', '1989']                                | 75                                              
   | Nino Farina FAR                                 | ITA                                             | Ferrari                                         | 4                                               | ['1952', '1953', '1954', '1955']                | 66                                              
   | Patrick Tambay TAM                              | FRA                                             | Ferrari                                         | 2                                               | ['1983', '1982']                                | 65                                              
   | Lorenzo Bandini BAN                             | ITA                                             | Ferrari                                         | 5                                               | ['1963', '1962', '1964', '1966', '1965']        | 58                                              
   | Jody Scheckter SCH                              | RSA                                             | Ferrari                                         | 2                                               | ['1979', '1980']                                | 53                                              
   | Jose Froilan Gonzalez GON                       | ARG                                             | Ferrari                                         | 4                                               | ['1954', '1955', '1951', '1957']                | 52                                              
   | Stefan Johansson JOH                            | SWE                                             | Ferrari                                         | 2                                               | ['1985', '1986']                                | 49                                              
   | Didier Pironi PIR                               | FRA                                             | Ferrari                                         | 2                                               | ['1981', '1982']                                | 48                                              
   | Peter Collins COL                               | GBR                                             | Ferrari                                         | 3                                               | ['1957', '1956', '1958']                        | 47                                              
   | Wolfgang von Trips VON                          | GER                                             | Ferrari                                         | 3                                               | ['1957', '1961', '1958']                        | 46                                              
   | Luigi Villoresi VIL                             | ITA                                             | Ferrari                                         | 3                                               | ['1952', '1951', '1953']                        | 40                                              
   | Chris Amon AMO                                  | NZL                                             | Ferrari                                         | 3                                               | ['1967', '1968', '1969']                        | 34                                              
   | Maurice Trintignant TRI                         | FRA                                             | Ferrari                                         | 3                                               | ['1957', '1954', '1955']                        | 33                                              
   | Luigi Musso MUS                                 | ITA                                             | Ferrari                                         | 3                                               | ['1958', '1956', '1957']                        | 32                                              
   | Piero Taruffi TAR                               | ITA                                             | Ferrari                                         | 2                                               | ['1952', '1951']                                | 32                                              
   | Juan Manuel Fangio FAN                          | ARG                                             | Ferrari                                         | 1                                               | ['1956']                                        | 30                                              
   | Tony Brooks BRO                                 | GBR                                             | Ferrari                                         | 1                                               | ['1959']                                        | 27                                              
   | Richie Ginther GIN                              | USA                                             | Ferrari                                         | 2                                               | ['1960', '1961']                                | 24                                              
   | Mario Andretti AND                              | USA                                             | Ferrari                                         | 3                                               | ['1971', '1982', '1972']                        | 20                                              
   | Eugenio Castellotti CAS                         | ITA                                             | Ferrari                                         | 2                                               | ['1956', '1955']                                | 19                                              
   | Giancarlo Baghetti BAG                          | ITA                                             | Ferrari                                         | 2                                               | ['1961', '1962']                                | 14                                              
   | Mike Parkes PAR                                 | GBR                                             | Ferrari                                         | 2                                               | ['1967', '1966']                                | 14                                              
   | Dan Gurney GUR                                  | USA                                             | Ferrari                                         | 1                                               | ['1959']                                        | 13                                              
   | Ludovico Scarfiotti SCA                         | ITA                                             | Ferrari                                         | 2                                               | ['1963', '1966']                                | 10                                              
   | Rudi Fischer FIS                                | SUI                                             | Ferrari                                         | 1                                               | ['1952']                                        | 10                                              
   | Paul Frere FRE                                  | BEL                                             | Ferrari                                         | 2                                               | ['1956', '1955']                                | 9                                               
   | Cliff Allison ALL                               | GBR                                             | Ferrari                                         | 2                                               | ['1960', '1959']                                | 8                                               
   | Arturo Merzario MER                             | ITA                                             | Ferrari                                         | 2                                               | ['1973', '1972']                                | 7                                               
   | Willy Mairesse MAI                              | BEL                                             | Ferrari                                         | 3                                               | ['1963', '1960', '1962']                        | 7                                               
   | Pedro Rodriguez ROD                             | MEX                                             | Ferrari                                         | 3                                               | ['1969', '1964', '1965']                        | 6                                               
   | Olivier Gendebien GEN                           | BEL                                             | Ferrari                                         | 2                                               | ['1956', '1959']                                | 5                                               
   | Ricardo Rodriguez ROD                           | MEX                                             | Ferrari                                         | 1                                               | ['1962']                                        | 4                                               
   | Robert Manzon MAN                               | FRA                                             | Ferrari                                         | 1                                               | ['1954']                                        | 4                                               
   | Alfonso de Portago DEP                          | ESP                                             | Ferrari                                         | 2                                               | ['1956', '1957']                                | 4                                               
   | Peter Whitehead WHI                             | GBR                                             | Ferrari                                         | 1                                               | ['1950']                                        | 4                                               
   | Umberto Maglioli MAG                            | ITA                                             | Ferrari                                         | 2                                               | ['1954', '1955']                                | 3                                               
   | Ignazio Giunti GIU                              | ITA                                             | Ferrari                                         | 1                                               | ['1970']                                        | 3                                               
   | Jean Behra BEH                                  | FRA                                             | Ferrari                                         | 1                                               | ['1959']                                        | 2                                               



Query n4: Get the top 10 countries with the most points scored by their national drivers since 2010, alongside with the number of drivers and the average points scored by a driver.
MATCH (driver:Driver)-[r:FOUGHT_FOR]->(championship:Championship) WITH driver.nationality AS country, count(driver) AS num_drivers, sum(toInteger(r.points)) AS total_points RETURN country, num_drivers, total_points, (total_points/num_drivers) AS points_per_driver ORDER BY total_points DESC LIMIT 10

   | country                                         | num_drivers                                     | total_points                                    | points_per_driver                               
   | GBR                                             | 285                                             | 9091                                            | 31                                              
   | GER                                             | 130                                             | 7833                                            | 60                                              
   | FIN                                             | 60                                              | 3982                                            | 66                                              
   | BRA                                             | 110                                             | 3414                                            | 31                                              
   | FRA                                             | 177                                             | 3044                                            | 17                                              
   | AUS                                             | 45                                              | 2579                                            | 57                                              
   | ESP                                             | 43                                              | 2271                                            | 52                                              
   | ITA                                             | 192                                             | 1979                                            | 10                                              
   | NED                                             | 21                                              | 1085                                            | 51                                              
   | AUT                                             | 44                                              | 988                                             | 22                                              



Query n5: Get the 3 drivers with the best position average (the less the better) in 'Portugal', who raced more than one time there and whose position was always 5th place or higher, alongside with the list of positions obtained and the date of the races.
MATCH (driver:Driver)-[r]->(race:Race) WHERE race.name STARTS WITH 'Portugal' WITH driver, sum(toInteger(r.position)) AS sum_positions, collect(toInteger(r.position)) AS positions, collect(race.date) AS dates, avg(toInteger(r.position)) AS avg_position WHERE all(position IN positions WHERE toInteger(position) < 6) AND size(positions) > 1 RETURN driver.name, driver.nationality, avg_position, positions, dates ORDER BY avg_position ASC LIMIT 3

   | driver.name                                     | driver.nationality                              | avg_position                                    | positions                                       | dates                                           
   | Stirling Moss MOS                               | GBR                                             | 1.0                                             | [1, 1]                                          | ['24-Aug-58', '23-Aug-59']                      
   | Damon Hill HIL                                  | GBR                                             | 2.25                                            | [3, 1, 3, 2]                                    | ['26-Sep-93', '25-Sep-94', '24-Sep-95', '22-Sep-96']
   | Elio de Angelis DEA                             | ITA                                             | 4.5                                             | [5, 4]                                          | ['21-Oct-84', '21-Apr-85']                      



Query n6: Get all the teams/constructors who fought for the 2014 championship, showing the team position, the total points obtained by the team, the drivers of the team in that year, its points and its positions. Order them by team position, from best to worse.
MATCH (team:Team)-[r1:FOUGHT_FOR]->(championship:Championship {year: '2014'})<-[r2:FOUGHT_FOR]-(driver:Driver) WHERE team.name = r2.team WITH team, toInteger(r1.points) AS team_points, toInteger(r1.position) AS team_position, collect(driver.name) AS drivers_names, collect(toInteger(r2.points)) AS drivers_points, collect(toInteger(r2.position)) AS drivers_positions RETURN team.name, team_position, team_points, drivers_names, drivers_points, drivers_positions  ORDER BY team_position ASC

   | team.name                                       | team_position                                   | team_points                                     | drivers_names                                   | drivers_points                                  | drivers_positions                               
   | Mercedes                                        | 1                                               | 701                                             | ['Lewis Hamilton HAM', 'Nico Rosberg ROS']      | [384, 317]                                      | [1, 2]                                          
   | Red Bull Racing Renault                         | 2                                               | 405                                             | ['Sebastian Vettel VET', 'Daniel Ricciardo RIC']| [167, 238]                                      | [5, 3]                                          
   | Williams Mercedes                               | 3                                               | 320                                             | ['Felipe Massa MAS', 'Valtteri Bottas BOT']     | [134, 186]                                      | [7, 4]                                          
   | Ferrari                                         | 4                                               | 216                                             | ['Kimi R�ikk�nen RAI', 'Fernando Alonso ALO']   | [55, 161]                                       | [12, 6]                                         
   | McLaren Mercedes                                | 5                                               | 181                                             | ['Jenson Button BUT', 'Kevin Magnussen MAG']    | [126, 55]                                       | [8, 11]                                         
   | Force India Mercedes                            | 6                                               | 155                                             | ['Nico Hulkenberg HUL', 'Sergio Perez PER']     | [96, 59]                                        | [9, 10]                                         
   | STR Renault                                     | 7                                               | 30                                              | ['Daniil Kvyat KVY', 'Jean-Eric Vergne VER']    | [8, 22]                                         | [15, 13]                                        
   | Lotus Renault                                   | 8                                               | 10                                              | ['Pastor Maldonado MAL', 'Romain Grosjean GRO'] | [2, 8]                                          | [16, 14]                                        
   | Marussia Ferrari                                | 9                                               | 2                                               | ['Jules Bianchi BIA', 'Max Chilton CHI']        | [2, 0]                                          | [17, 21]                                        
   | Sauber Ferrari                                  | 10                                              | 0                                               | ['Esteban Gutierrez GUT', 'Adrian Sutil SUT']   | [0, 0]                                          | [20, 18]                                        
   | Caterham Renault                                | 11                                              | 0                                               | ['Will Stevens STE', 'Kamui Kobayashi KOB', 'Marcus Ericsson ERI']| [0, 0, 0]                                       | [23, 22, 19]                                    



Query n7: Get the top 10 teams who are in Formula 1 for the longest time, showing the number of pilots they had and the number of years they fought for championships.
MATCH (team:Team)-[:FOUGHT_FOR]->(championship:Championship)<-[:FOUGHT_FOR]-(driver:Driver) WITH team, count(DISTINCT championship) AS num_years, count(DISTINCT driver) AS num_drivers RETURN team.name,num_years,num_drivers ORDER BY num_years DESC LIMIT 10

   | team.name                                       | num_years                                       | num_drivers                                     
   | Ferrari                                         | 63                                              | 319                                             
   | Renault                                         | 23                                              | 148                                             
   | McLaren Mercedes                                | 20                                              | 104                                             
   | Lotus Ford                                      | 19                                              | 120                                             
   | Tyrrell Ford                                    | 19                                              | 118                                             
   | McLaren Ford                                    | 18                                              | 117                                             
   | BRM                                             | 16                                              | 127                                             
   | Williams Renault                                | 11                                              | 95                                              
   | Brabham Ford                                    | 11                                              | 81                                              
   | Mercedes                                        | 11                                              | 67                                              



Query n8: Get the best result 'Sergio Perez' ever got in a F1 race, showing the position he got and the name and date of the race.
MATCH (driver:Driver {name: 'Sergio Perez PER'})-[r:RACED_IN]->(race:Race) WITH driver,toInteger(r.position) AS position, race RETURN driver.name,driver.nationality,position,race.name,race.date ORDER BY position ASC LIMIT 1

   | driver.name                                     | driver.nationality                              | position                                        | race.name                                       | race.date                                       
   | Sergio Perez PER                                | MEX                                             | 2                                               | Malaysia.13                                     | 25-Mar-12                                       



Query n9: Get the driver who scored the most points in a F1 championship.
MATCH (driver:Driver)-[r:FOUGHT_FOR]->(championship:Championship) WITH driver,championship,toInteger(r.points) AS points RETURN driver.name,driver.nationality,points,championship.year ORDER BY points DESC LIMIT 1

   | driver.name                                     | driver.nationality                              | points                                          | championship.year                               
   | Lewis Hamilton HAM                              | GBR                                             | 413                                             | 2019                                            



Query n10: Get the standings obtained by 'Michael Schumacher' throughout each year of his career, his points and the car he raced.
MATCH (driver:Driver {name: 'Michael Schumacher MSC'})-[r:FOUGHT_FOR]->(championship:Championship) WITH driver,championship,toInteger(r.points) AS points, toInteger(r.position) AS position, r.team AS team RETURN driver.name,driver.nationality,championship.year as year,position,points,team ORDER BY toInteger(championship.year) ASC

   | driver.name                                     | driver.nationality                              | year                                            | position                                        | points                                          | team                                            
   | Michael Schumacher MSC                          | GER                                             | 1991                                            | 12                                              | 4                                               | Benetton Ford                                   
   | Michael Schumacher MSC                          | GER                                             | 1992                                            | 3                                               | 53                                              | Benetton Ford                                   
   | Michael Schumacher MSC                          | GER                                             | 1993                                            | 4                                               | 52                                              | Benetton Ford                                   
   | Michael Schumacher MSC                          | GER                                             | 1994                                            | 1                                               | 92                                              | Benetton Ford                                   
   | Michael Schumacher MSC                          | GER                                             | 1995                                            | 1                                               | 102                                             | Benetton Renault                                
   | Michael Schumacher MSC                          | GER                                             | 1996                                            | 3                                               | 59                                              | Ferrari                                         
   | Michael Schumacher MSC                          | GER                                             | 1997                                            | None                                            | 78                                              | Ferrari                                         
   | Michael Schumacher MSC                          | GER                                             | 1998                                            | 2                                               | 86                                              | Ferrari                                         
   | Michael Schumacher MSC                          | GER                                             | 1999                                            | 5                                               | 44                                              | Ferrari                                         
   | Michael Schumacher MSC                          | GER                                             | 2000                                            | 1                                               | 108                                             | Ferrari                                         
   | Michael Schumacher MSC                          | GER                                             | 2001                                            | 1                                               | 123                                             | Ferrari                                         
   | Michael Schumacher MSC                          | GER                                             | 2002                                            | 1                                               | 144                                             | Ferrari                                         
   | Michael Schumacher MSC                          | GER                                             | 2003                                            | 1                                               | 93                                              | Ferrari                                         
   | Michael Schumacher MSC                          | GER                                             | 2004                                            | 1                                               | 148                                             | Ferrari                                         
   | Michael Schumacher MSC                          | GER                                             | 2005                                            | 3                                               | 62                                              | Ferrari                                         
   | Michael Schumacher MSC                          | GER                                             | 2006                                            | 2                                               | 121                                             | Ferrari                                         
   | Michael Schumacher MSC                          | GER                                             | 2010                                            | 9                                               | 72                                              | Mercedes                                        
   | Michael Schumacher MSC                          | GER                                             | 2011                                            | 8                                               | 76                                              | Mercedes                                        
   | Michael Schumacher MSC                          | GER                                             | 2012                                            | 13                                              | 49                                              | Mercedes                                        



